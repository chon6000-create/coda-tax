<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>세무정석 v1046 - 유튜버 종합소득세 AI 장부</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://service.iamport.kr/js/iamport.payment-1.1.8.js"></script>
  <script type="module" crossorigin src="/coda-tax/index.js"></script>
  <link rel="stylesheet" crossorigin href="/coda-tax/index.css">
</head>

<body>
    <div class="bg-decor">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="version-tag">Koda Engine v1046 Alpha</div>
        <div class="blob blob-3"></div>
    </div>

    <!-- 1. Landing View -->
    <div id="user-type-overlay" class="overlay">
        <div class="glass-card login-card" style="text-align:center;">
            <div style="margin-bottom:2rem;">
                <h1 style="font-size:1.8rem; font-weight:900; color:var(--text-primary); margin-bottom:0.5rem;">세무정석 AI
                </h1>
                <p style="color:var(--text-muted); font-size:0.9rem;">유튜버를 위한 가장 똑똑한 세금 관리</p>
            </div>

            <div id="login-form-area">
                <form onsubmit="kodaEngine.login(event)" style="display:flex; flex-direction:column; gap:1rem;">
                    <input type="text" id="login-id" placeholder="아이디 (또는 이메일)" required>
                    <input type="password" id="login-pw" placeholder="비밀번호" required>
                    <button type="submit" class="btn-primary" style="padding:1.2rem; font-weight:700;">시작하기</button>
                    <button type="button" class="btn-secondary" onclick="kodaEngine.loginWithGoogle()"
                        style="display:flex; align-items:center; justify-content:center; gap:0.5rem;">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/layout/google.svg" width="18">
                        구글로 계속하기
                    </button>
                </form>
                <p style="margin-top:1.5rem; font-size:0.85rem; color:var(--text-muted);">
                    계정이 없으신가요? <a href="#" onclick="kodaEngine.tryStartService()"
                        style="color:var(--primary); font-weight:700;">가입하기</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 2. Main Dashboard -->
    <div id="app-container" class="app-container" style="display:none; padding: 20px; padding-bottom: 60px;">
        <div style="position:fixed; top:5px; right:5px; font-size:10px; color:rgba(255,255,255,0.1); z-index:10000;">
            v1046</div>
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
            <h1 style="font-size:1.2rem; font-weight:900; line-height:1.2;">유튜버<br>종합소득세 신고앱</h1>
            <div id="user-status-indicator" style="font-size:0.8rem; color:var(--text-muted);">
                <span id="logged-in-user-id">User</span>님 | <a href="#" onclick="kodaEngine.logout()"
                    style="color:var(--text-muted);">로그아웃</a>
            </div>
        </header>

        <section class="summary-section">
            <div class="glass-card stat-card dark" onclick="kodaEngine.showPrevYearSummary()">
                <label>전년도 실적 (종소세용)</label>
                <div class="value">AI 요약/입력</div>
                <div class="tag blue">신고전용</div>
            </div>
            <div class="glass-card stat-card active" onclick="kodaEngine.showYearlyCategorySummary()">
                <label>2025년 현재 실적</label>
                <div class="value">항목별 리포트</div>
                <div class="tag green">실시간</div>
            </div>
        </section>

        <section style="margin-top:2rem;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <h3 style="font-size:1rem; font-weight:700;">최근 기록</h3>
                <button class="btn-text" onclick="kodaEngine.openAddModal()">내역 전체보기 ›</button>
            </div>
            <div class="glass-card" style="padding:0; overflow:hidden;">
                <table class="data-table">
                    <tbody id="history-list-mvp"></tbody>
                </table>
            </div>
        </section>

        <!-- Floating Voice Button -->
        <button class="floating-voice-btn" onclick="kodaEngine.startVoiceRecord()">🎙️</button>
    </div>

    <!-- AI 요약 가이드 모달 (v1046 필수) -->
    <div id="bulk-modal" class="modal-overlay" style="display:none; z-index:999999 !important;">
        <div class="modal-content" style="max-width:600px; padding:2rem;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                <h2 style="font-size:1.2rem; font-weight:900;">AI 요약 및 간편 입력</h2>
                <span style="font-size:2rem; cursor:pointer;" onclick="get('bulk-modal').style.display='none'">✕</span>
            </div>

            <div id="bulk-input-area" style="text-align: center;">
                <div
                    style="background:rgba(59,130,246,0.1); padding:20px; border-radius:16px; margin-bottom:20px; text-align:left;">
                    <p style="font-size:0.9rem; line-height:1.6; margin-bottom:20px;">
                        1. 아래 버튼을 눌러 <b>AI용 프롬프트</b>를 복사하세요.<br>
                        2. 카드/은행 내역을 AI에 주고 항목별 합계를 요약 시키세요.<br>
                        3. AI가 알려준 합계에서 <b>개인 지출을 뺀 최종 금액</b>을 음성으로 말씀하시면 장부에 입력됩니다.
                    </p>
                    <button onclick="kodaEngine.copyGeminiPrompt()" class="btn-primary"
                        style="width:100%; padding:15px; margin-bottom:15px;">
                        📋 AI 요약 프롬프트 복사
                    </button>
                    <div
                        style="background:rgba(255,100,100,0.1); padding:12px; border-radius:10px; border:1px solid rgba(255,100,100,0.3); color:#ff6b6b; font-size:0.75rem;">
                        ⚠️ <b>필독</b>: 사적 지출(식대, 옷값 등)은 본인이 직접 제외해야 합니다. 세무상 책임은 사용자 본인에게 있습니다.
                    </div>
                </div>

                <div style="padding:20px; border:2px dashed rgba(59,130,246,0.3); border-radius:20px;">
                    <p style="margin-bottom:15px; font-weight:600;">합계 금액을 말씀하세요</p>
                    <button onclick="kodaEngine.startVoiceRecord()"
                        style="width:70px; height:70px; border-radius:50%; background:var(--primary); border:none; color:white; font-size:1.8rem;">🎙️</button>
                    <p style="margin-top:15px; font-size:0.8rem; color:var(--text-muted);">"광고비 22번, 542만원" 이라고 말씀해 보세요.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 음성 입력 모달 -->
    <div id="voice-modal" class="modal-overlay" style="display:none; z-index:1000000 !important;">
        <div class="modal-content voice-content" style="max-width:400px;">
            <p id="voice-status-text" style="font-weight:700;">듣고 있습니다...</p>
            <div id="voice-transcribed-text" class="voice-transcript" style="margin:20px 0;">...</div>
            <div id="voice-result-box" style="display:none; width:100%;">
                <button class="btn-primary" onclick="kodaEngine.confirmVoiceEntry()" style="width:100%;">기록 확정</button>
            </div>
            <button class="modal-close" onclick="get('voice-modal').style.display='none'">✕</button>
        </div>
    </div>

    <!-- 리포트 모달 -->
    <div id="report-modal" class="modal-overlay" style="display:none; z-index:999998 !important;">
        <div class="modal-content" style="max-width:500px; width:90%; padding:2rem;">
            <h2 id="report-title" style="margin-bottom:1.5rem;">세분화 분석 리포트</h2>
            <div id="report-content" style="max-height: 60vh; overflow-y: auto; margin-bottom: 2rem;"></div>
            <button class="btn-primary" onclick="kodaEngine.closeReportModal()" style="width:100%;">확인</button>
            <button class="modal-close" onclick="kodaEngine.closeReportModal()">✕</button>
        </div>
    </div>

    <!-- Toast UI & Footer -->
    <div id="app-toast"></div>
    <div style="margin-top:25px; text-align:center; opacity:0.3; font-size:10px; cursor:pointer; padding-bottom:50px;"
        onclick="location.reload(true)">시스템 강제 새로고침 (v1046)</div>
</body>

</html>